!***********************************************************************!
!																		!
!                       Fasolt3   -Shapef								!
!                        Pete Bate 2000									!
!-----------------------------------------------------------------------!
!               Shape function routines for 3-d FEM						!
!-----------------------------------------------------------------------!
!																		!
!  In all routines, arguments are:										!
!        gpnumber    INTEGER(4)         The local Gauss point number	!
!        xnode       REAL(4) array(3,n) The global node coordinates		!
!        n           REAL(4) array(n)   The shape functions at nodes	!
!        dndx        REAL(4) array(3,n) The shape function derivatives	!
!                                       wrt global coords at nodes		!
!        weight		 REAL				The volume weighting			!
!-----------------------------------------------------------------------!
!    NB Shape function routines have FAILED if weight zero				!
!       Results in this case for other returned vaues are meaningless	!
!																		!
!***********************************************************************!
!
!***********************************************************************!
!																		!
!          SHAPE_12    8 node, 1 Gauss point hexahedron					!
!-----------------------------------------------------------------------!
!   Nodes 1,2,3,4 bottom face, 5,6,7,8 top face (anticlockwise,			!
!									             looking down from top)	!
!   Gauss point is at coordinates  {0, 0, 0}							!
!-----------------------------------------------------------------------!
!																		!
!***********************************************************************!
SUBROUTINE SHAPE_12( gpnumber, xnode, n, dndx, weight )

	IMPLICIT NONE

!--------------------------------Argument type declarations
	INTEGER(4)	gpnumber
	REAL(4)     xnode, n, dndx, weight

	DIMENSION	xnode( 1:3, 1:8), n( 1:8), dndx( 1:3, 1:8)

!------------------------------------Local type declarations
	INTEGER(4)	i, j, k
	REAL(4)		shapef, dndn, jac_mat, sum
	DIMENSION	shapef( 1:8, 1:1), dndn( 1:3, 1:8, 1:1), jac_mat( 1:3, 1:3)

!---------Data for shape functions and local basis shape function derivatives-----!

	DATA (shapef(i, 1), i=1,8)/  8* 0.125 	 /

	DATA (dndn(1, i, 1),i=1,8)/  -0.125, 0.125, 0.125,-0.125,-0.125, 0.125, 0.125,-0.125 /
	DATA (dndn(2, i, 1),i=1,8)/  -0.125,-0.125, 0.125, 0.125,-0.125,-0.125, 0.125, 0.125 /
	DATA (dndn(3, i, 1),i=1,8)/  -0.125,-0.125,-0.125,-0.125, 0.125, 0.125, 0.125, 0.125 /

!-------------------------------------Simple allocate shape functions
	DO i= 1, 8
		n( i)= shapef( i, gpnumber )
	END DO

!---------------------------------------------Sum dndn.x for Jacobian
	DO k= 1, 3				!Global coordinate
		DO j= 1, 3			!Local coordinate
			sum= 0.
			DO i=1,8		!Node number
				sum= sum + dndn( j, i, gpnumber )* xnode(k, i )
			END DO
			jac_mat( j, k)= sum 
		END DO
	END DO

!-----------------------------------Invert Jacobian, getting determinant
	CALL INVERT_3( jac_mat, weight)

!---------------------------------Form global shape function derivatives
	DO i= 1, 8				!Node number
		DO k= 1, 3			!Global coordinate
			sum= 0.
			DO j= 1, 3		!Local coordinate
				sum= sum + jac_mat( k, j)*dndn( j, i, gpnumber)
			END DO
			dndx(k, i)= sum
		END DO
	END DO

	weight= 8.*weight		!Gauss weighting for all

END SUBROUTINE SHAPE_12

!***********************************************************************!
!																		!
!          SHAPE_21    10 node, 4 Gauss point tetrahedron				!
!-----------------------------------------------------------------------!
!   Corner nodes 1,3,5,10 in RH sense:									!
!				looking down from 10; 1,3,5 anticlockwise				!
!	Intermediate nodes are between:										!
!             2 (1,3) 4(3,5), 6(1,5), 7(1,10), 8(3,10), 9(5,10)			!
!   Gauss points are at volume coordinates of type						!
!                             {0.585, 0.138, 0.138, 0.138}				!
!    -with 1 nearest node 1, 2 nearest node 3 etc.						!
!-----------------------------------------------------------------------!
!  Tested uniform displacement field etc. 14/2/00						!
!																		!
!***********************************************************************!
SUBROUTINE SHAPE_21( gpnumber, xnode, n, dndx, weight )

	IMPLICIT NONE

!--------------------------------Argument type declarations
	INTEGER(4)	gpnumber
	REAL(4)     xnode, n, dndx, weight

	DIMENSION	xnode( 1:3, 1:10), n( 1:10), dndx( 1:3, 1:10)

!------------------------------------Local type declarations
	INTEGER(4)	i, j, k
	REAL(4)		shapef, dndn, jac_mat, sum
	DIMENSION	shapef( 1:10, 1:4), dndn( 1:3, 1:10, 1:4), jac_mat( 1:3, 1:3)

!---------Data for shape functions and local basis shape function derivatives-----!

	DATA (shapef(i, 1), i=1,10)/   0.100000, 0.323607,-0.100000, 0.076393,-0.100000, &
								&  0.323607, 0.323607, 0.076393, 0.076393,-0.100000	 /
	DATA (shapef(i, 2), i=1,10)/  -0.100000, 0.323607, 0.100000, 0.323607,-0.100000, &
								&  0.076393, 0.076393, 0.323607, 0.076393,-0.100000  /
	DATA (shapef(i, 3), i=1,10)/  -0.100000, 0.076393,-0.100000, 0.323607, 0.100000, &
								&  0.323607, 0.076393, 0.076393, 0.323607,-0.100000  /
	DATA (shapef(i, 4), i=1,10)/  -0.100000, 0.076393,-0.100000, 0.076393,-0.100000, &
								&  0.076393, 0.323607, 0.323607, 0.323607, 0.100000  /

	DATA (dndn(1, i, 1),i=1,10)/   0.000000, 0.000000, 0.000000,-0.552786, 0.447214, &
								& -2.341641, 2.341641, 0.552786, 0.000000,-0.447214  /
	DATA (dndn(1, i, 2),i=1,10)/   0.000000, 0.000000, 0.000000,-2.341641, 0.447214, &
								& -0.552786, 0.552786, 2.341641, 0.000000,-0.447214  /
	DATA (dndn(1, i, 3),i=1,10)/   0.000000, 0.000000, 0.000000,-0.552786,-1.341641, &
								& -0.552786, 0.552786, 0.552786, 1.788854,-0.447214  /
	DATA (dndn(1, i, 4),i=1,10)/   0.000000, 0.000000, 0.000000,-0.552786, 0.447214, &
								& -0.552786, 0.552786, 0.552786,-1.788854, 1.341641  /	

	DATA (dndn(2, i, 1),i=1,10)/   0.000000, 2.341641,-0.447214, 0.000000, 0.447214, &
								& -2.341641, 0.000000, 0.552786,-0.552786, 0.000000  /
	DATA (dndn(2, i, 2),i=1,10)/   0.000000, 0.552786, 1.341641,-1.788854, 0.447214, &
								& -0.552786, 0.000000, 0.552786,-0.552786, 0.000000  /
	DATA (dndn(2, i, 3),i=1,10)/   0.000000, 0.552786,-0.447214, 1.788854,-1.341641, &
								& -0.552786, 0.000000, 0.552786,-0.552786, 0.000000  /
	DATA (dndn(2, i, 4),i=1,10)/   0.000000, 0.552786,-0.447214, 0.000000, 0.447214, &
								& -0.552786, 0.000000, 2.341641,-2.341641, 0.000000  /

	DATA (dndn(3, i, 1),i=1,10)/   1.341641, 0.552786, 0.000000,-0.552786, 0.447214, &
								& -1.788854, 0.552786, 0.000000,-0.552786, 0.000000  /
	DATA (dndn(3, i, 2),i=1,10)/  -0.447214, 2.341641, 0.000000,-2.341641, 0.447214, &
								&  0.000000, 0.552786, 0.000000,-0.552786, 0.000000  /
	DATA (dndn(3, i, 3),i=1,10)/  -0.447214, 0.552786, 0.000000,-0.552786,-1.341641, &
								&  1.788854, 0.552786, 0.000000,-0.552786, 0.000000  /
	DATA (dndn(3, i, 4),i=1,10)/  -0.447214, 0.552786, 0.000000,-0.552786, 0.447214, &
								&  0.000000, 2.341641, 0.000000,-2.341641, 0.000000  /

!-------------------------------------Simple allocate shape functions
	DO i= 1, 10
		n( i)= shapef( i, gpnumber )
	END DO

!---------------------------------------------Sum dndn.x for Jacobian
	DO k= 1, 3				!Global coordinate
		DO j= 1, 3			!Local coordinate
			sum= 0.
			DO i=1,10		!Node number
				sum= sum + dndn( j, i, gpnumber )* xnode(k, i )
			END DO
			jac_mat( j, k)= sum 
		END DO
	END DO

!-----------------------------------Invert Jacobian, getting determinant
	CALL INVERT_3( jac_mat, weight)

!---------------------------------Form global shape function derivatives
	DO i= 1, 10				!Node number
		DO k= 1, 3			!Global coordinate
			sum= 0.
			DO j= 1, 3		!Local coordinate
				sum= sum + jac_mat( k, j)*dndn( j, i, gpnumber)
			END DO
			dndx(k, i)= sum
		END DO
	END DO

	weight= - 0.0416667 * weight		!Gauss weighting for all

END SUBROUTINE SHAPE_21

!***********************************************************************!
!																		!
!          SHAPE_22    20 node, 8 Gauss point hexahedron				!
!-----------------------------------------------------------------------!
!   Bottom face (Z = -1),												!
!				anticlockwise view from top: corner nodes 1,3,5,7		!
!										 mid-sides    2,4,6,8			!
!   Top face (Z = 1),													!
!				anticlockwise view from top: corner nodes 13,15,17,19	!
!										 mid-sides    14,16,18,20   	!
!	Intermediate nodes are between:										!
!					9 (1,13) 10(3,15), 11(5,17), 12(7,19)				!
!   Gauss points are at volume coordinates of type						!
!                             {+-0.5773 x,y,z}							!
!   -with 1..4 anticlock. above bottom face, 6..8 below top face		!
!-----------------------------------------------------------------------!
!  Tested uniform displacement field etc. 18/2/00						!
!																		!
!***********************************************************************!
SUBROUTINE SHAPE_22( gpnumber, xnode, n, dndx, weight )

	IMPLICIT NONE

!--------------------------------Argument type declarations
	INTEGER(4)	gpnumber
	REAL(4)     xnode, n, dndx, weight

	DIMENSION	xnode( 1:3, 1:20), n( 1:20), dndx( 1:3, 1:20)

!------------------------------------Local type declarations
	INTEGER(4)	i, j, k
	REAL(4)		shapef, dndn, jac_mat, sum
	DIMENSION	shapef( 1:20, 1:8), dndn( 1:3, 1:20, 1:8), jac_mat( 1:3, 1:3)

!---------Data for shape functions and local basis shape function derivatives-----!

	DATA (shapef(i, 1), i=1,20)/  -0.131446, 0.414672,-0.187001, 0.111111,-0.090776, &
								&  0.111111,-0.187001, 0.414672, 0.414672, 0.111111, &
								&  0.029772, 0.111111,-0.187001, 0.111111,-0.090776, &
								&  0.029772,-0.035221, 0.029772,-0.090776, 0.111111  /
	DATA (shapef(i, 2), i=1,20)/  -0.187001, 0.414672,-0.131446, 0.414672,-0.187001, &
								&  0.111111,-0.090776, 0.111111, 0.111111, 0.414672, &
								&  0.111111, 0.029772,-0.090776, 0.111111,-0.187001, &
								&  0.111111,-0.090776, 0.029772,-0.035221, 0.029772  /
	DATA (shapef(i, 3), i=1,20)/  -0.090776, 0.111111,-0.187001, 0.414672,-0.131446, &
								&  0.414672,-0.187001, 0.111111, 0.029772, 0.111111, &
								&  0.414672, 0.111111,-0.035221, 0.029772,-0.090776, &
								&  0.111111,-0.187001, 0.111111,-0.090776, 0.029772  /
	DATA (shapef(i, 4), i=1,20)/  -0.187001, 0.111111,-0.090776, 0.111111,-0.187001, &
								&  0.414672,-0.131446, 0.414672, 0.111111, 0.029772, &
								&  0.111111, 0.414672,-0.090776, 0.029772,-0.035221, &
								&  0.029772,-0.090776, 0.111111,-0.187001, 0.111111  /
	DATA (shapef(i, 5), i=1,20)/  -0.187001, 0.111111,-0.090776, 0.029772,-0.035221, &
								&  0.029772,-0.090776, 0.111111, 0.414672, 0.111111, &
								&  0.029772, 0.111111,-0.131446, 0.414672,-0.187001, &
								&  0.111111,-0.090776, 0.111111,-0.187001, 0.414672  /
	DATA (shapef(i, 6), i=1,20)/  -0.090776, 0.111111,-0.187001, 0.111111,-0.090776, &
								&  0.029772,-0.035221, 0.029772, 0.111111, 0.414672, &
								&  0.111111, 0.029772,-0.187001, 0.414672,-0.131446, &
								&  0.414672,-0.187001, 0.111111,-0.090776, 0.111111  /
	DATA (shapef(i, 7), i=1,20)/  -0.035221, 0.029772,-0.090776, 0.111111,-0.187001, &
								&  0.111111,-0.090776, 0.029772, 0.029772, 0.111111, &
								&  0.414672, 0.111111,-0.090776, 0.111111,-0.187001, &
								&  0.414672,-0.131446, 0.414672,-0.187001, 0.111111  /
	DATA (shapef(i, 8), i=1,20)/  -0.090776, 0.029772,-0.035221, 0.029772,-0.090776, &
								&  0.111111,-0.187001, 0.111111, 0.111111, 0.029772, &
								&  0.111111, 0.414672,-0.187001, 0.111111,-0.090776, &
								&  0.111111,-0.187001, 0.414672,-0.131446, 0.414672  /

	DATA (((dndn(j, i, k),i=1,20), j=1, 3), k= 1, 8)/ &
&-0.407229, 0.718233,-0.311004, 0.262892,-0.179558, 0.192450,-0.012892,-0.262892,-0.262892, 0.262892,&
& 0.070442,-0.070442,-0.012892, 0.192450,-0.179558, 0.070442,-0.073896, 0.051567, 0.022329,-0.070442,&
&-0.407229,-0.262892,-0.012892, 0.192450,-0.179558, 0.262892,-0.311004, 0.718233,-0.262892,-0.070442,&
& 0.070442, 0.262892,-0.012892,-0.070442, 0.022329, 0.051567,-0.073896, 0.070442,-0.179558, 0.192450,&
&-0.407229,-0.262892,-0.012892,-0.070442, 0.022329,-0.070442,-0.012892,-0.262892, 0.718233, 0.192450,&
& 0.051567, 0.192450,-0.311004, 0.262892,-0.179558, 0.070442,-0.073896, 0.070442,-0.179558, 0.262892,&
& 0.311004,-0.718233, 0.407229, 0.262892, 0.012892,-0.192450, 0.179558,-0.262892,-0.262892, 0.262892,&
& 0.070442,-0.070442, 0.179558,-0.192450, 0.012892, 0.070442,-0.022329,-0.051567, 0.073896,-0.070442,&
&-0.012892,-0.262892,-0.407229, 0.718233,-0.311004, 0.262892,-0.179558, 0.192450,-0.070442,-0.262892,&
& 0.262892, 0.070442, 0.022329,-0.070442,-0.012892, 0.192450,-0.179558, 0.070442,-0.073896, 0.051567,&
&-0.012892,-0.262892,-0.407229,-0.262892,-0.012892,-0.070442, 0.022329,-0.070442, 0.192450, 0.718233,&
& 0.192450, 0.051567,-0.179558, 0.262892,-0.311004, 0.262892,-0.179558, 0.070442,-0.073896, 0.070442,&
& 0.179558,-0.192450, 0.012892, 0.262892, 0.407229,-0.718233, 0.311004,-0.262892,-0.070442, 0.070442,&
& 0.262892,-0.262892, 0.073896,-0.051567,-0.022329, 0.070442, 0.012892,-0.192450, 0.179558,-0.070442,&
& 0.179558,-0.262892, 0.311004,-0.718233, 0.407229, 0.262892, 0.012892,-0.192450,-0.070442,-0.262892,&
& 0.262892, 0.070442, 0.073896,-0.070442, 0.179558,-0.192450, 0.012892, 0.070442,-0.022329,-0.051567,&
& 0.022329,-0.070442,-0.012892,-0.262892,-0.407229,-0.262892,-0.012892,-0.070442, 0.051567, 0.192450,&
& 0.718233, 0.192450,-0.073896, 0.070442,-0.179558, 0.262892,-0.311004, 0.262892,-0.179558, 0.070442,&
&-0.012892, 0.192450,-0.179558, 0.262892,-0.311004, 0.718233,-0.407229,-0.262892,-0.070442, 0.070442,&
& 0.262892,-0.262892, 0.022329, 0.051567,-0.073896, 0.070442,-0.179558, 0.192450,-0.012892,-0.070442,&
& 0.311004,-0.262892, 0.179558,-0.192450, 0.012892, 0.262892, 0.407229,-0.718233,-0.262892,-0.070442,&
& 0.070442, 0.262892, 0.179558,-0.070442, 0.073896,-0.051567,-0.022329, 0.070442, 0.012892,-0.192450,&
&-0.012892,-0.070442, 0.022329,-0.070442,-0.012892,-0.262892,-0.407229,-0.262892, 0.192450, 0.051567,&
& 0.192450, 0.718233,-0.179558, 0.070442,-0.073896, 0.070442,-0.179558, 0.262892,-0.311004, 0.262892,&
&-0.012892, 0.192450,-0.179558, 0.070442,-0.073896, 0.051567, 0.022329,-0.070442,-0.262892, 0.262892,&
& 0.070442,-0.070442,-0.407229, 0.718233,-0.311004, 0.262892,-0.179558, 0.192450,-0.012892,-0.262892,&
&-0.012892,-0.070442, 0.022329, 0.051567,-0.073896, 0.070442,-0.179558, 0.192450,-0.262892,-0.070442,&
& 0.070442, 0.262892,-0.407229,-0.262892,-0.012892, 0.192450,-0.179558, 0.262892,-0.311004, 0.718233,&
& 0.311004,-0.262892, 0.179558,-0.070442, 0.073896,-0.070442, 0.179558,-0.262892,-0.718233,-0.192450,&
&-0.051567,-0.192450, 0.407229, 0.262892, 0.012892, 0.070442,-0.022329, 0.070442, 0.012892, 0.262892,&
& 0.179558,-0.192450, 0.012892, 0.070442,-0.022329,-0.051567, 0.073896,-0.070442,-0.262892, 0.262892,&
& 0.070442,-0.070442, 0.311004,-0.718233, 0.407229, 0.262892, 0.012892,-0.192450, 0.179558,-0.262892,&
& 0.022329,-0.070442,-0.012892, 0.192450,-0.179558, 0.070442,-0.073896, 0.051567,-0.070442,-0.262892,&
& 0.262892, 0.070442,-0.012892,-0.262892,-0.407229, 0.718233,-0.311004, 0.262892,-0.179558, 0.192450,&
& 0.179558,-0.262892, 0.311004,-0.262892, 0.179558,-0.070442, 0.073896,-0.070442,-0.192450,-0.718233,&
&-0.192450,-0.051567, 0.012892, 0.262892, 0.407229, 0.262892, 0.012892, 0.070442,-0.022329, 0.070442,&
& 0.073896,-0.051567,-0.022329, 0.070442, 0.012892,-0.192450, 0.179558,-0.070442,-0.070442, 0.070442,&
& 0.262892,-0.262892, 0.179558,-0.192450, 0.012892, 0.262892, 0.407229,-0.718233, 0.311004,-0.262892,&
& 0.073896,-0.070442, 0.179558,-0.192450, 0.012892, 0.070442,-0.022329,-0.051567,-0.070442,-0.262892,&
& 0.262892, 0.070442, 0.179558,-0.262892, 0.311004,-0.718233, 0.407229, 0.262892, 0.012892,-0.192450,&
& 0.073896,-0.070442, 0.179558,-0.262892, 0.311004,-0.262892, 0.179558,-0.070442,-0.051567,-0.192450,&
&-0.718233,-0.192450,-0.022329, 0.070442, 0.012892, 0.262892, 0.407229, 0.262892, 0.012892, 0.070442,&
& 0.022329, 0.051567,-0.073896, 0.070442,-0.179558, 0.192450,-0.012892,-0.070442,-0.070442, 0.070442,&
& 0.262892,-0.262892,-0.012892, 0.192450,-0.179558, 0.262892,-0.311004, 0.718233,-0.407229,-0.262892,&
& 0.179558,-0.070442, 0.073896,-0.051567,-0.022329, 0.070442, 0.012892,-0.192450,-0.262892,-0.070442,&
& 0.070442, 0.262892, 0.311004,-0.262892, 0.179558,-0.192450, 0.012892, 0.262892, 0.407229,-0.718233,&
& 0.179558,-0.070442, 0.073896,-0.070442, 0.179558,-0.262892, 0.311004,-0.262892,-0.192450,-0.051567,&
&-0.192450,-0.718233, 0.012892, 0.070442,-0.022329, 0.070442, 0.012892, 0.262892, 0.407229, 0.262892 /

!-------------------------------------Simple allocate shape functions
	DO i= 1, 20
		n( i)= shapef( i, gpnumber )
	END DO

!---------------------------------------------Sum dndn.x for Jacobian
	DO k= 1, 3				!Global coordinate
		DO j= 1, 3			!Local coordinate
			sum= 0.
			DO i=1,20		!Node number
				sum= sum + dndn( j, i, gpnumber )* xnode(k, i )
			END DO
			jac_mat( j, k)= sum 
		END DO
	END DO

!-----------------------------------Invert Jacobian, getting determinant
	CALL INVERT_3( jac_mat, weight)

!---------------------------------Form global shape function derivatives
	DO i= 1, 20				!Node number
		DO k= 1, 3			!Global coordinate
			sum= 0.
			DO j= 1, 3		!Local coordinate
				sum= sum + jac_mat( k, j)*dndn( j, i, gpnumber)
			END DO
			dndx(k, i)= sum
		END DO
	END DO

	weight=  1.0 *weight		!Gauss weighting for all

END SUBROUTINE SHAPE_22

!***********************************************************************!
!																		!
!          SHAPE_23    15 node, 6 Gauss point pentahedron				!
!-----------------------------------------------------------------------!
!   Corner nodes 1,3,5 base, 10,12,14 top								!
!				 anticlockwise	height +ve definition					!
!	intermediate nodes are (between):									!
!				2(1,3) 4(3,5), 6(5,1), 7(1,10), 8(3,12),				!
!				9(5,14), 11(10,12),13(12,14),15(14,10)					!
!   Gauss points are at area+z coordinates of type						!
!                          {0.66, 0.16, 0.16, 0.577}					!
!    -with 1 nearest node 1, 2 nearest node 3 etc.						!
!-----------------------------------------------------------------------!
!  Tested uniform displacement field etc. 21/2/00						!
!																		!
!***********************************************************************!
SUBROUTINE SHAPE_23( gpnumber, xnode, n, dndx, weight )

	IMPLICIT NONE

!--------------------------------Argument type declarations
	INTEGER(4)	gpnumber
	REAL(4)     xnode, n, dndx, weight

	DIMENSION	xnode( 1:3, 1:15), n( 1:15), dndx( 1:3, 1:15)

!------------------------------------Local type declarations
	INTEGER(4)	i, j, k
	REAL(4)		shapef, dndn, jac_mat, sum
	DIMENSION	shapef( 1:15, 1:6), dndn( 1:3, 1:15, 1:6), jac_mat( 1:3, 1:3)

!---------Data for shape functions and local basis shape function derivatives-----!

	DATA (shapef(i, 1), i=1,15)/  -0.046961, 0.350522,-0.143186, 0.087631,-0.143186, &
								&  0.350522, 0.444444, 0.111111, 0.111111,-0.175261, &
								&  0.093922,-0.079036, 0.023481,-0.079036, 0.093922  /
	DATA (shapef(i, 2), i=1,15)/  -0.143186, 0.350522,-0.046961, 0.350522,-0.143186, &
								&  0.087631, 0.111111, 0.444444, 0.111111,-0.079036, &
								&  0.093922,-0.175261, 0.093922,-0.079036, 0.023481  /
	DATA (shapef(i, 3), i=1,15)/  -0.143186, 0.087631,-0.143186, 0.350522,-0.046961, &
								&  0.350522, 0.111111, 0.111111, 0.444444,-0.079036, &
								&  0.023481,-0.079036, 0.093922,-0.175261, 0.093922  /
	DATA (shapef(i, 4), i=1,15)/  -0.175261, 0.093922,-0.079036, 0.023481,-0.079036, &
								&  0.093922, 0.444444, 0.111111, 0.111111,-0.046961, &
								&  0.350522,-0.143186, 0.087631,-0.143186, 0.350522  /
	DATA (shapef(i, 5), i=1,15)/  -0.079036, 0.093922,-0.175261, 0.093922,-0.079036, &
								&  0.023481, 0.111111, 0.444444, 0.111111,-0.143186, &
								&  0.350522,-0.046961, 0.350522,-0.143186, 0.087631  /
	DATA (shapef(i, 6), i=1,15)/  -0.079036, 0.023481,-0.079036, 0.093922,-0.175261, &
								&  0.093922, 0.111111, 0.111111, 0.444444,-0.143186, &
								&  0.087631,-0.143186, 0.350522,-0.046961, 0.350522  /

	DATA (dndn(1, i, 1),i=1,15)/   0.981124, 0.525783, 0.000000,-0.525784, 0.596225, &
								& -1.577352, 0.666666, 0.000000,-0.666667, 0.018875, &
								&  0.140883, 0.000000,-0.140883, 0.403775,-0.422650  /
	DATA (dndn(1, i, 2),i=1,15)/  -0.596225, 2.103135, 0.000000,-2.103135, 0.596225, &
								&  0.000000, 0.666667, 0.000000,-0.666667,-0.403775, &
								&  0.563533, 0.000000,-0.563533, 0.403775, 0.000000  /
	DATA (dndn(1, i, 3),i=1,15)/  -0.596225, 0.525784, 0.000000,-0.525783,-0.981124, &
								&  1.577352, 0.666667, 0.000000,-0.666666,-0.403775, &
								&  0.140883, 0.000000,-0.140883,-0.018875, 0.422650 /
	DATA (dndn(1, i, 4),i=1,15)/   0.018875, 0.140883, 0.000000,-0.140883, 0.403775, &
								& -0.422650, 0.666666, 0.000000,-0.666667, 0.981124, &
								&  0.525783, 0.000000,-0.525784, 0.596225,-1.577352  /
	DATA (dndn(1, i, 5),i=1,15)/  -0.403775, 0.563533, 0.000000,-0.563533, 0.403775, &
								&  0.000000, 0.666667, 0.000000,-0.666667,-0.596225, &
								&  2.103135, 0.000000,-2.103135, 0.596225, 0.000000  /
	DATA (dndn(1, i, 6),i=1,15)/  -0.403775, 0.140883, 0.000000,-0.140883,-0.018875, &
								&  0.422650, 0.666667, 0.000000,-0.666666,-0.596225, &
								&  0.525784, 0.000000,-0.525783,-0.981124, 1.577352  /

	DATA (dndn(2, i, 1),i=1,15)/   0.000000, 2.103135,-0.596225, 0.000000, 0.596225, &
								& -2.103135, 0.000000, 0.666667,-0.666667, 0.000000, &
								&  0.563533,-0.403775, 0.000000, 0.403775,-0.563533  /
	DATA (dndn(2, i, 2),i=1,15)/   0.000000, 0.525783, 0.981124,-1.577352, 0.596225, &
								& -0.525784, 0.000000, 0.666666,-0.666667, 0.000000, &
								&  0.140883, 0.018875,-0.422650, 0.403775,-0.140883  /
	DATA (dndn(2, i, 3),i=1,15)/   0.000000, 0.525784,-0.596225, 1.577352,-0.981124, &
								& -0.525783, 0.000000, 0.666667,-0.666666, 0.000000, &
								&  0.140883,-0.403775, 0.422650,-0.018875,-0.140883  /
	DATA (dndn(2, i, 4),i=1,15)/   0.000000, 0.563533,-0.403775, 0.000000, 0.403775, &
								& -0.563533, 0.000000, 0.666667,-0.666667, 0.000000, &
								&  2.103135,-0.596225, 0.000000, 0.596225,-2.103135  /
	DATA (dndn(2, i, 5),i=1,15)/   0.000000, 0.140883, 0.018875,-0.422650, 0.403775, &
								& -0.140883, 0.000000, 0.666666,-0.666667, 0.000000, &
								&  0.525783, 0.981124,-1.577352, 0.596225,-0.525784  /
	DATA (dndn(2, i, 6),i=1,15)/   0.000000, 0.140883,-0.403775, 0.422650,-0.018875, &
								& -0.140883, 0.000000, 0.666667,-0.666666, 0.000000, &
								&  0.525784,-0.596225, 1.577352,-0.981124,-0.525783  /

	DATA (dndn(3, i, 1),i=1,15)/  -0.496011,-0.222222,-0.040669,-0.055555,-0.040669, &
								& -0.222222, 0.769800, 0.192450, 0.192450,-0.273789, &
								&  0.222222,-0.151780, 0.055555,-0.151780, 0.222222  /
	DATA (dndn(3, i, 2),i=1,15)/  -0.040669,-0.222222,-0.496011,-0.222222,-0.040669, &
								& -0.055555, 0.192450, 0.769800, 0.192450,-0.151780, &
								&  0.222222,-0.273789, 0.222222,-0.151780, 0.055555  /
	DATA (dndn(3, i, 3),i=1,15)/  -0.040669,-0.055556,-0.040669,-0.222222,-0.496011, &
								& -0.222222, 0.192450, 0.192450, 0.769800,-0.151780, &
								&  0.055556,-0.151780, 0.222222,-0.273789, 0.222222  /
	DATA (dndn(3, i, 4),i=1,15)/   0.273789,-0.222222, 0.151780,-0.055555, 0.151780, &
								& -0.222222,-0.769800,-0.192450,-0.192450, 0.496011, &
								&  0.222222, 0.040669, 0.055555, 0.040669, 0.222222  /
	DATA (dndn(3, i, 5),i=1,15)/   0.151780,-0.222222, 0.273789,-0.222222, 0.151780, &
								& -0.055555,-0.192450,-0.769800,-0.192450, 0.040669, &
								&  0.222222, 0.496011, 0.222222, 0.040669, 0.055555  /
	DATA (dndn(3, i, 6),i=1,15)/   0.151780,-0.055556, 0.151780,-0.222222, 0.273789, &
								& -0.222222,-0.192450,-0.192450,-0.769800, 0.040669, &
								&  0.055556, 0.040669, 0.222222, 0.496011, 0.222222  /

!-------------------------------------Simple allocate shape functions
	DO i= 1, 15
		n( i)= shapef( i, gpnumber )
	END DO

!---------------------------------------------Sum dndn.x for Jacobian
	DO k= 1, 3				!Global coordinate
		DO j= 1, 3			!Local coordinate
			sum= 0.
			DO i=1,15		!Node number
				sum= sum + dndn( j, i, gpnumber )* xnode(k, i )
			END DO
			jac_mat( j, k)= sum 
		END DO
	END DO

!-----------------------------------Invert Jacobian, getting determinant
	CALL INVERT_3( jac_mat, weight)

!---------------------------------Form global shape function derivatives
	DO i= 1, 15				!Node number
		DO k= 1, 3			!Global coordinate
			sum= 0.
			DO j= 1, 3		!Local coordinate
				sum= sum + jac_mat( k, j)*dndn( j, i, gpnumber)
			END DO
			dndx(k, i)= sum
		END DO
	END DO

	weight= 0.16666667*weight		!Gauss weighting	

END SUBROUTINE SHAPE_23

!***********************************************************************!
!																		!
!     SUBROUTINE INVERT_3												!
!						 Pete Bate										!
!-----------------------------------------------------------------------!
!   Routine to invert a 3x3 square matrix, overwriting and giving		!
!   the determinant. This is done by minor evaluation- OK, matrix small !
!-----------------------------------------------------------------------!
!  Arguments:   matrix		REAL ARRAY(1:3, 1:3) the matrix				!
!				determinant REAL, matrix determinant					!
!																		!
!***********************************************************************!
SUBROUTINE INVERT_3( matrix, determinant)

	IMPLICIT NONE

	REAL(4)		matrix, determinant
	DIMENSION   matrix( 1:3, 1:3 )

	INTEGER(4)	i, j, JM, ia, ib, ja, jb
	REAL(4)		local
	DIMENSION	local( 1:3, 1:3)

	JM(i) = 1 + MOD( i, 3)  !statement function for cyclic next in 1,2,3,1,..

	local = matrix			!put input matrix to local array

	DO	i= 1, 3
		ia= JM(i)
		ib= JM(ia)

		DO j= 1, 3
			ja= JM( j)
			jb= JM(ja)

			matrix(j,i)= local(ia,ja)*local(ib,jb) - local(ia,jb)*local(ib,ja)
		END DO
	END DO
	
	determinant= matrix(1,1)*local(1,1) +matrix(1,2)*local(2,1) + matrix(1,3)*local(3,1)

	IF ( determinant .NE. 0.) THEN
		DO i= 1, 3
			DO j= 1, 3
				matrix( i, j)= matrix( i, j)/ determinant
			END DO
		END DO
	END IF

END SUBROUTINE INVERT_3


